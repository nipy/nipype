<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Neuroimaging in Python - Pipelines and Interfaces &mdash; nipy pipeline and interfaces package</title>
    
    <link rel="stylesheet" href="../../_static/nipype.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '0.11.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="author" title="About these documents" href="../../about.html" />
    <link rel="top" title="nipy pipeline and interfaces package" href="../../index.html" />
 
<meta name="keywords" content="nipype, neuroimaging, pipeline, workflow, parallel, python, neuroscience">
<script type="text/javascript">
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-339450-7', 'nipy.org/nipype');
  ga('send', 'pageview');
</script>

  </head>
  <body role="document">
<div class="header-wrapper">
    <div style="background-color: white; text-align: left; padding: 10px 10px 15px 15px">
            <a href="../../index.html">
            <img src="../../_static/nipype-banner-bg.png" alt="NIPY logo"  border="0" />
        <div style="margin-top: 1em;
                border-top: 1px solid #AAA;
                border-bottom: 1px solid #AAA;
                border-radius: 5px;
                padding: 3px 1em;">
            <link rel="stylesheet" href="http://www.google.com/cse/style/look/default.css" type="text/css" />
<style type="text/css">
    a.navbar {
    color: ;
    letter-spacing: .05em;
    font-weight: bold;
        }
</style>

<a class="navbar" href="../../index.html">Home</a> ·
<a class="navbar" href="../../quickstart.html">Quickstart</a> ·
<a class="navbar" href="../../documentation.html">Documentation</a> ·
<a class="navbar" href="../../about.html">Citation</a> ·
<a class="navbar" href="http://nipy.org">NiPy</a>

        </div>
    </div>
</div>

      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<style type="text/css">
    input.gsc-input {
        border-color: #BCCDF0;
    }
    input.gsc-search-button {
        border-color: #666666;
        background-color: #CECECE;
        padding: 0;
    }
    div.sphinxsidebar .tile {
        border: 1px solid #D1DDE2;
        border-radius: 10px;
        background-color: #E1E8EC;
        padding-left: 0.5em;
        margin: 1em 0;
    }
    div.sphinxsidebar input[type="text"] {
        width: 100%;
    }
    div.sphinxsidebar input[type="submit"] {
        width: 100%;
    }
</style>

<div class="sidebarblock">
    <div id="cse-search-form">Loading</div>

    <script src="http://www.google.com/jsapi" type="text/javascript"></script>
    <script type="text/javascript">
        google.load('search', '1', {language : 'en'});
        google.setOnLoadCallback(function() {
            var customSearchControl = new google.search.CustomSearchControl(
                    '010960497803984932957:u8pmqf7fdoq');

            customSearchControl.setResultSetSize(google.search.Search.FILTERED_CSE_RESULTSET);
            var options = new google.search.DrawOptions();
            options.enableSearchboxOnly("../../searchresults.html");
            customSearchControl.draw('cse-search-form', options);
        }, true);
    </script>
</div>

  <h3><a href="../../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">fMRI: FEEDS - FSL</a><ul>
<li><a class="reference internal" href="#preliminaries">Preliminaries</a></li>
<li><a class="reference internal" href="#experiment-specific-components">Experiment specific components</a><ul>
<li><a class="reference internal" href="#set-up-complete-workflow">Set up complete workflow</a></li>
</ul>
</li>
<li><a class="reference internal" href="#execute-the-pipeline">Execute the pipeline</a></li>
</ul>
</li>
</ul>

<style type="text/css">
    div.sphinxsidebar .tile {
        border: 1px solid #D1DDE2;
        border-radius: 10px;
        background-color: #E1E8EC;
        padding-left: 0.5em;
        margin: 1em 0;
    }
</style>
<div class="sidebarblock">
    <h3>Versions</h3>

    <div class="tile">
        <table style="width: 100%;">
            <tr style="font-weight: bold;">
                <td align="left">Release</td><td align="right">Devel</td>
            </tr>
            <tr>
                <td align="left">0.11.0</td><td align="right">0.11.0</td>
            </tr>
            <tr>
                <td align="left"><a href="../install.html">Download</a></td>
                <td align="right"><a href="https://github.com/nipy/nipype">Github</a></td>
            </tr>
        </table>
    </div>

    <div id="buttons">
        <div id="ohloh-use" style="margin-right: 25px; margin-top: -2px; float: left;">
            <script type="text/javascript"
                    src="https://www.openhub.net/p/480871/widgets/project_users_logo.js">
            </script>
        </div><!-- use -->
        <g:plusone size="medium" annotation="none"></g:plusone>
        <div class="clear"></div>
    </div><!-- buttons container -->
</div>


<script type="text/javascript">
    (function() {
        var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
        po.src = 'https://apis.google.com/js/plusone.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
    })();
</script>

<h3>Links</h3>

<ul>
    <li>Docs: <a href="http://nipy.org/nipype">Stable</a> · <a href="http://www.mit.edu/~satra/nipype-nightly/">Nightly</a></li>
    <li>Code: <a href="http://github.com/nipy/nipype">Github</a> · <a href="http://github.com/nipy/nipype/issues">Bugs-Requests</a></li>
    <li>Forum: <a href="http://neurostars.org/t/nipype">User</a> · <a href="http://projects.scipy.org/mailman/listinfo/nipy-devel">Developer</a></li>
    <li><a href="http://nipy.org/software/license/index.html"><img src="https://img.shields.io/pypi/l/nipype.svg" alt="License"></a> · <a href="http://nipy.org/about/funding.html">Funding</a></li>
    <li><a href="https://travis-ci.org/nipy/nipype"><img src="https://travis-ci.org/nipy/nipype.png?branch=master" alt="travis"></a> · <a href='https://coveralls.io/r/nipy/nipype'><img src='https://coveralls.io/repos/nipy/nipype/badge.png' alt='Coverage Status' /></a></li>
    <li><a href="https://pypi.python.org/pypi/nipype/"><img src="https://img.shields.io/pypi/dm/nipype.svg" alt="Downloads"></a> · <a href='https://pypi.python.org/pypi/nipype/'><img src='https://img.shields.io/pypi/pyversions/nipype.svg' alt='Python Versions' /></a></li>
</ul>


        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="fmri-feeds-fsl">
<span id="example-fmri-fsl-feeds"></span><h1>fMRI: FEEDS - FSL<a class="headerlink" href="#fmri-feeds-fsl" title="Permalink to this headline">¶</a></h1>
<p>A pipeline example that data from the FSL FEEDS set. Single subject, two
stimuli.</p>
<p>You can find it at <a class="reference external" href="http://www.fmrib.ox.ac.uk/fsl/feeds/doc/index.html">http://www.fmrib.ox.ac.uk/fsl/feeds/doc/index.html</a></p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">os</span>                                    <span class="c"># system functions</span>

<span class="kn">import</span> <span class="nn">nipype.interfaces.io</span> <span class="kn">as</span> <span class="nn">nio</span>           <span class="c"># Data i/o</span>
<span class="kn">import</span> <span class="nn">nipype.interfaces.fsl</span> <span class="kn">as</span> <span class="nn">fsl</span>          <span class="c"># fsl</span>
<span class="kn">import</span> <span class="nn">nipype.pipeline.engine</span> <span class="kn">as</span> <span class="nn">pe</span>          <span class="c"># pypeline engine</span>
<span class="kn">import</span> <span class="nn">nipype.algorithms.modelgen</span> <span class="kn">as</span> <span class="nn">model</span>   <span class="c"># model generation</span>
<span class="kn">from</span> <span class="nn">nipype.workflows.fmri.fsl</span> <span class="kn">import</span> <span class="p">(</span><span class="n">create_featreg_preproc</span><span class="p">,</span>
                                       <span class="n">create_modelfit_workflow</span><span class="p">,</span>
                                       <span class="n">create_reg_workflow</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">nipype.interfaces.base</span> <span class="kn">import</span> <span class="n">Bunch</span>
</pre></div>
</div>
<div class="section" id="preliminaries">
<h2>Preliminaries<a class="headerlink" href="#preliminaries" title="Permalink to this headline">¶</a></h2>
<p>Setup any package specific configuration. The output file format for FSL
routines is being set to compressed NIFTI.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">fsl</span><span class="o">.</span><span class="n">FSLCommand</span><span class="o">.</span><span class="n">set_default_output_type</span><span class="p">(</span><span class="s">&#39;NIFTI_GZ&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="experiment-specific-components">
<h2>Experiment specific components<a class="headerlink" href="#experiment-specific-components" title="Permalink to this headline">¶</a></h2>
<p>This tutorial does a single subject analysis so we are not using infosource and
iterables</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># Specify the location of the FEEDS data. You can find it at http://www.fmrib.ox.ac.uk/fsl/feeds/doc/index.html</span>
<span class="n">feeds_data_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="s">&#39;feeds/data&#39;</span><span class="p">)</span>
<span class="c"># Specify the subject directories</span>
<span class="c"># Map field names to individual subject runs.</span>
<span class="n">info</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">func</span><span class="o">=</span><span class="p">[[</span><span class="s">&#39;fmri&#39;</span><span class="p">]],</span>
            <span class="n">struct</span><span class="o">=</span><span class="p">[[</span><span class="s">&#39;structural&#39;</span><span class="p">]])</span>
</pre></div>
</div>
<p>Now we create a <code class="xref py py-class docutils literal"><span class="pre">nipype.interfaces.io.DataSource</span></code> object and fill in the
information from above about the layout of our data.  The
<code class="xref py py-class docutils literal"><span class="pre">nipype.pipeline.Node</span></code> module wraps the interface object and provides
additional housekeeping and pipeline specific functionality.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">datasource</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="n">interface</span><span class="o">=</span><span class="n">nio</span><span class="o">.</span><span class="n">DataGrabber</span><span class="p">(</span><span class="n">outfields</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;func&#39;</span><span class="p">,</span> <span class="s">&#39;struct&#39;</span><span class="p">]),</span>
                     <span class="n">name</span> <span class="o">=</span> <span class="s">&#39;datasource&#39;</span><span class="p">)</span>
<span class="n">datasource</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">base_directory</span> <span class="o">=</span> <span class="n">feeds_data_dir</span>
<span class="n">datasource</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">template</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">.nii.gz&#39;</span>
<span class="n">datasource</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">template_args</span> <span class="o">=</span> <span class="n">info</span>
<span class="n">datasource</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">sort_filelist</span> <span class="o">=</span> <span class="bp">True</span>

<span class="n">preproc</span> <span class="o">=</span> <span class="n">create_featreg_preproc</span><span class="p">(</span><span class="n">whichvol</span><span class="o">=</span><span class="s">&#39;first&#39;</span><span class="p">)</span>
<span class="n">TR</span> <span class="o">=</span> <span class="mf">3.</span>
<span class="n">preproc</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">inputspec</span><span class="o">.</span><span class="n">fwhm</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">preproc</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">inputspec</span><span class="o">.</span><span class="n">highpass</span> <span class="o">=</span> <span class="mi">100</span><span class="o">/</span><span class="n">TR</span>

<span class="n">modelspec</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="n">interface</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">SpecifyModel</span><span class="p">(),</span>
                    <span class="n">name</span><span class="o">=</span><span class="s">&quot;modelspec&quot;</span><span class="p">)</span>
<span class="n">modelspec</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">input_units</span> <span class="o">=</span> <span class="s">&#39;secs&#39;</span>
<span class="n">modelspec</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">time_repetition</span> <span class="o">=</span> <span class="n">TR</span>
<span class="n">modelspec</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">high_pass_filter_cutoff</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">modelspec</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">subject_info</span> <span class="o">=</span> <span class="p">[</span><span class="n">Bunch</span><span class="p">(</span><span class="n">conditions</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;Visual&#39;</span><span class="p">,</span><span class="s">&#39;Auditory&#39;</span><span class="p">],</span>
                                <span class="n">onsets</span><span class="o">=</span><span class="p">[</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">int</span><span class="p">(</span><span class="mi">180</span><span class="o">*</span><span class="n">TR</span><span class="p">),</span><span class="mi">60</span><span class="p">),</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">int</span><span class="p">(</span><span class="mi">180</span><span class="o">*</span><span class="n">TR</span><span class="p">),</span><span class="mi">90</span><span class="p">)],</span>
                                <span class="n">durations</span><span class="o">=</span><span class="p">[[</span><span class="mi">30</span><span class="p">],</span> <span class="p">[</span><span class="mi">45</span><span class="p">]],</span>
                                <span class="n">amplitudes</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                                <span class="n">tmod</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                                <span class="n">pmod</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                                <span class="n">regressor_names</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                                <span class="n">regressors</span><span class="o">=</span><span class="bp">None</span><span class="p">)]</span>

<span class="n">modelfit</span> <span class="o">=</span> <span class="n">create_modelfit_workflow</span><span class="p">(</span><span class="n">f_contrasts</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">modelfit</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">inputspec</span><span class="o">.</span><span class="n">interscan_interval</span> <span class="o">=</span> <span class="n">TR</span>
<span class="n">modelfit</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">inputspec</span><span class="o">.</span><span class="n">model_serial_correlations</span> <span class="o">=</span> <span class="bp">True</span>
<span class="n">modelfit</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">inputspec</span><span class="o">.</span><span class="n">bases</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;dgamma&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s">&#39;derivs&#39;</span><span class="p">:</span> <span class="bp">True</span><span class="p">}}</span>
<span class="n">cont1</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;Visual&gt;Baseline&#39;</span><span class="p">,</span><span class="s">&#39;T&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s">&#39;Visual&#39;</span><span class="p">,</span><span class="s">&#39;Auditory&#39;</span><span class="p">],[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]]</span>
<span class="n">cont2</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;Auditory&gt;Baseline&#39;</span><span class="p">,</span><span class="s">&#39;T&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s">&#39;Visual&#39;</span><span class="p">,</span><span class="s">&#39;Auditory&#39;</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]]</span>
<span class="n">cont3</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;Task&#39;</span><span class="p">,</span><span class="s">&#39;F&#39;</span><span class="p">,</span> <span class="p">[</span><span class="n">cont1</span><span class="p">,</span> <span class="n">cont2</span><span class="p">]]</span>
<span class="n">modelfit</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">inputspec</span><span class="o">.</span><span class="n">contrasts</span> <span class="o">=</span> <span class="p">[</span><span class="n">cont1</span><span class="p">,</span><span class="n">cont2</span><span class="p">,</span><span class="n">cont3</span><span class="p">]</span>

<span class="n">registration</span> <span class="o">=</span> <span class="n">create_reg_workflow</span><span class="p">()</span>
<span class="n">registration</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">inputspec</span><span class="o">.</span><span class="n">target_image</span> <span class="o">=</span> <span class="n">fsl</span><span class="o">.</span><span class="n">Info</span><span class="o">.</span><span class="n">standard_image</span><span class="p">(</span><span class="s">&#39;MNI152_T1_2mm.nii.gz&#39;</span><span class="p">)</span>
<span class="n">registration</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">inputspec</span><span class="o">.</span><span class="n">target_image_brain</span> <span class="o">=</span> <span class="n">fsl</span><span class="o">.</span><span class="n">Info</span><span class="o">.</span><span class="n">standard_image</span><span class="p">(</span><span class="s">&#39;MNI152_T1_2mm_brain.nii.gz&#39;</span><span class="p">)</span>
<span class="n">registration</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">inputspec</span><span class="o">.</span><span class="n">config_file</span> <span class="o">=</span> <span class="s">&#39;T1_2_MNI152_2mm&#39;</span>
</pre></div>
</div>
<div class="section" id="set-up-complete-workflow">
<h3>Set up complete workflow<a class="headerlink" href="#set-up-complete-workflow" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python"><div class="highlight"><pre><span class="n">l1pipeline</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Workflow</span><span class="p">(</span><span class="n">name</span><span class="o">=</span> <span class="s">&quot;level1&quot;</span><span class="p">)</span>
<span class="n">l1pipeline</span><span class="o">.</span><span class="n">base_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="s">&#39;./fsl_feeds/workingdir&#39;</span><span class="p">)</span>
<span class="n">l1pipeline</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="p">{</span><span class="s">&quot;execution&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s">&quot;crashdump_dir&quot;</span><span class="p">:</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="s">&#39;./fsl_feeds/crashdumps&#39;</span><span class="p">)}}</span>

<span class="n">l1pipeline</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">datasource</span><span class="p">,</span> <span class="s">&#39;func&#39;</span><span class="p">,</span> <span class="n">preproc</span><span class="p">,</span><span class="s">&#39;inputspec.func&#39;</span><span class="p">)</span>
<span class="n">l1pipeline</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">preproc</span><span class="p">,</span> <span class="s">&#39;outputspec.highpassed_files&#39;</span><span class="p">,</span> <span class="n">modelspec</span><span class="p">,</span> <span class="s">&#39;functional_runs&#39;</span><span class="p">)</span>
<span class="n">l1pipeline</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">preproc</span><span class="p">,</span> <span class="s">&#39;outputspec.motion_parameters&#39;</span><span class="p">,</span> <span class="n">modelspec</span><span class="p">,</span> <span class="s">&#39;realignment_parameters&#39;</span><span class="p">)</span>
<span class="n">l1pipeline</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">modelspec</span><span class="p">,</span> <span class="s">&#39;session_info&#39;</span><span class="p">,</span> <span class="n">modelfit</span><span class="p">,</span> <span class="s">&#39;inputspec.session_info&#39;</span><span class="p">)</span>
<span class="n">l1pipeline</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">preproc</span><span class="p">,</span> <span class="s">&#39;outputspec.highpassed_files&#39;</span><span class="p">,</span> <span class="n">modelfit</span><span class="p">,</span> <span class="s">&#39;inputspec.functional_data&#39;</span><span class="p">)</span>
<span class="n">l1pipeline</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">preproc</span><span class="p">,</span> <span class="s">&#39;outputspec.mean&#39;</span><span class="p">,</span> <span class="n">registration</span><span class="p">,</span> <span class="s">&#39;inputspec.mean_image&#39;</span><span class="p">)</span>
<span class="n">l1pipeline</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">datasource</span><span class="p">,</span> <span class="s">&#39;struct&#39;</span><span class="p">,</span> <span class="n">registration</span><span class="p">,</span> <span class="s">&#39;inputspec.anatomical_image&#39;</span><span class="p">)</span>
<span class="n">l1pipeline</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">modelfit</span><span class="p">,</span> <span class="s">&#39;outputspec.zfiles&#39;</span><span class="p">,</span> <span class="n">registration</span><span class="p">,</span> <span class="s">&#39;inputspec.source_files&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Setup the datasink</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">datasink</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="n">interface</span><span class="o">=</span><span class="n">nio</span><span class="o">.</span><span class="n">DataSink</span><span class="p">(</span><span class="n">parameterization</span><span class="o">=</span><span class="bp">False</span><span class="p">),</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;datasink&quot;</span><span class="p">)</span>
<span class="n">datasink</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">base_directory</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="s">&#39;./fsl_feeds/l1out&#39;</span><span class="p">)</span>
<span class="n">datasink</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">substitutions</span> <span class="o">=</span> <span class="p">[(</span><span class="s">&#39;fmri_dtype_mcf_mask_smooth_mask_gms_mean_warp&#39;</span><span class="p">,</span> <span class="s">&#39;meanfunc&#39;</span><span class="p">)]</span>
<span class="c"># store relevant outputs from various stages of the 1st level analysis</span>
<span class="n">l1pipeline</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">registration</span><span class="p">,</span> <span class="s">&#39;outputspec.transformed_files&#39;</span><span class="p">,</span> <span class="n">datasink</span><span class="p">,</span> <span class="s">&#39;level1.@Z&#39;</span><span class="p">)</span>
<span class="n">l1pipeline</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">registration</span><span class="p">,</span> <span class="s">&#39;outputspec.transformed_mean&#39;</span><span class="p">,</span> <span class="n">datasink</span><span class="p">,</span> <span class="s">&#39;meanfunc&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="execute-the-pipeline">
<h2>Execute the pipeline<a class="headerlink" href="#execute-the-pipeline" title="Permalink to this headline">¶</a></h2>
<p>The code discussed above sets up all the necessary data structures with
appropriate parameters and the connectivity between the processes, but does not
generate any output. To actually run the analysis on the data the
<code class="docutils literal"><span class="pre">nipype.pipeline.engine.Pipeline.Run</span></code> function needs to be called.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">l1pipeline</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
<div class="admonition-example-source-code admonition">
<p class="first admonition-title">Example source code</p>
<p class="last">You can download <a class="reference download internal" href="../../_downloads/fmri_fsl_feeds.py"><code class="xref download docutils literal"><span class="pre">the</span> <span class="pre">full</span> <span class="pre">source</span> <span class="pre">code</span> <span class="pre">of</span> <span class="pre">this</span> <span class="pre">example</span></code></a>.
This same script is also included in the Nipype source distribution under the
<code class="file docutils literal"><span class="pre">examples</span></code> directory.</p>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>

    <div class="footer" role="contentinfo">
        &copy; Copyright 2009-15, Neuroimaging in Python team.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.3.1.
    </div>
<div class="footer">This page uses <a href="http://analytics.google.com/">
Google Analytics</a> to collect statistics. You can disable it by blocking
the JavaScript coming from www.google-analytics.com.
</div>

  </body>
</html>