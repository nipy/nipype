<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Neuroimaging in Python - Pipelines and Interfaces &mdash; nipy pipeline and interfaces package</title>
    
    <link rel="stylesheet" href="../_static/nipype.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.9.2',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="author" title="About these documents" href="../about.html" />
    <link rel="top" title="nipy pipeline and interfaces package" href="../index.html" />
 
<meta name="keywords" content="nipype, neuroimaging, pipeline, workflow, parallel, python, neuroscience">
<script type="text/javascript">
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-339450-7', 'nipy.org/nipype');
  ga('send', 'pageview');
</script>

  </head>
  <body role="document">
<div class="header-wrapper">
    <div style="background-color: white; text-align: left; padding: 10px 10px 15px 15px">
            <a href="../index.html">
            <img src="../_static/nipype-banner-bg.png" alt="NIPY logo"  border="0" />
        <div style="margin-top: 1em;
                border-top: 1px solid #AAA;
                border-bottom: 1px solid #AAA;
                border-radius: 5px;
                padding: 3px 1em;">
            <link rel="stylesheet" href="http://www.google.com/cse/style/look/default.css" type="text/css" />
<style type="text/css">
    a.navbar {
    color: ;
    letter-spacing: .05em;
    font-weight: bold;
        }
</style>

<a class="navbar" href="../index.html">Home</a> ·
<a class="navbar" href="../quickstart.html">Quickstart</a> ·
<a class="navbar" href="../documentation.html">Documentation</a> ·
<a class="navbar" href="../about.html">Citation</a> ·
<a class="navbar" href="http://nipy.org">NiPy</a>

        </div>
    </div>
</div>

      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<style type="text/css">
    input.gsc-input {
        border-color: #BCCDF0;
    }
    input.gsc-search-button {
        border-color: #666666;
        background-color: #CECECE;
        padding: 0;
    }
    div.sphinxsidebar .tile {
        border: 1px solid #D1DDE2;
        border-radius: 10px;
        background-color: #E1E8EC;
        padding-left: 0.5em;
        margin: 1em 0;
    }
    div.sphinxsidebar input[type="text"] {
        width: 100%;
    }
    div.sphinxsidebar input[type="submit"] {
        width: 100%;
    }
</style>

<div class="sidebarblock">
    <div id="cse-search-form">Loading</div>

    <script src="http://www.google.com/jsapi" type="text/javascript"></script>
    <script type="text/javascript">
        google.load('search', '1', {language : 'en'});
        google.setOnLoadCallback(function() {
            var customSearchControl = new google.search.CustomSearchControl(
                    '010960497803984932957:u8pmqf7fdoq');

            customSearchControl.setResultSetSize(google.search.Search.FILTERED_CSE_RESULTSET);
            var options = new google.search.DrawOptions();
            options.enableSearchboxOnly("../searchresults.html");
            customSearchControl.draw('cse-search-form', options);
        }, true);
    </script>
</div>

  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">DataGrabber and DataSink explained</a><ul>
<li><a class="reference internal" href="#why-do-we-need-these-interfaces">Why do we need these interfaces?</a></li>
<li><a class="reference internal" href="#datagrabber">DataGrabber</a><ul>
<li><a class="reference internal" href="#a-more-realistic-use-case">A more realistic use-case</a></li>
</ul>
</li>
<li><a class="reference internal" href="#datasink">DataSink</a><ul>
<li><a class="reference internal" href="#mapnode">MapNode</a></li>
<li><a class="reference internal" href="#parameterization">Parameterization</a></li>
<li><a class="reference internal" href="#substitutions">Substitutions</a></li>
</ul>
</li>
</ul>
</li>
</ul>

<style type="text/css">
    div.sphinxsidebar .tile {
        border: 1px solid #D1DDE2;
        border-radius: 10px;
        background-color: #E1E8EC;
        padding-left: 0.5em;
        margin: 1em 0;
    }
</style>
<div class="sidebarblock">
    <h3>Versions</h3>

    <div class="tile">
        <table style="width: 100%;">
            <tr style="font-weight: bold;">
                <td align="left">Release</td><td align="right">Devel</td>
            </tr>
            <tr>
                <td align="left">0.9.2</td><td align="right">1.0-dev</td>
            </tr>
            <tr>
                <td align="left"><a href="install.html">Download</a></td>
                <td align="right"><a href="https://github.com/nipy/nipype">Github</a></td>
            </tr>
        </table>
    </div>

    <div id="buttons">
        <div id="ohloh-use" style="margin-right: 25px; margin-top: -2px; float: left;">
            <script type="text/javascript"
                    src="http://www.ohloh.net/p/480871/widgets/project_users_logo.js">
            </script>
        </div><!-- use -->
        <g:plusone size="medium" annotation="none"></g:plusone>
        <div class="clear"></div>
    </div><!-- buttons container -->
</div>


<script type="text/javascript">
    (function() {
        var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
        po.src = 'https://apis.google.com/js/plusone.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
    })();
</script>

<h3>Links</h3>

<ul>
    <li>Docs: <a href="http://nipy.org/nipype">Stable</a> · <a href="http://www.mit.edu/~satra/nipype-nightly/">Nightly</a></li>
    <li>Code: <a href="http://github.com/nipy/nipype">Github</a> · <a href="http://github.com/nipy/nipype/issues">Bugs-Requests</a></li>
    <li>Forum: <a href="http://groups.google.com/group/nipy-user">User</a> · <a href="http://projects.scipy.org/mailman/listinfo/nipy-devel">Developer</a></li>
    <li>Info: <a href="http://nipy.org/software/license/index.html">License</a> · <a href="http://nipy.org/about/funding.html">Funding</a></li>
    <li><a href="https://travis-ci.org/nipy/nipype"><img src="https://travis-ci.org/nipy/nipype.png?branch=master" alt="travis"></a> · <a href='https://coveralls.io/r/nipy/nipype'><img src='https://coveralls.io/repos/nipy/nipype/badge.png' alt='Coverage Status' /></a></li>
</ul>


        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="datagrabber-and-datasink-explained">
<span id="grabbing-and-sinking"></span><h1>DataGrabber and DataSink explained<a class="headerlink" href="#datagrabber-and-datasink-explained" title="Permalink to this headline">¶</a></h1>
<p>In this chapter we will try to explain the concepts behind DataGrabber and
<a class="reference internal" href="../interfaces/generated/nipype.interfaces.io.html#nipype-interfaces-io-datasink"><span>DataSink</span></a>.</p>
<div class="section" id="why-do-we-need-these-interfaces">
<h2>Why do we need these interfaces?<a class="headerlink" href="#why-do-we-need-these-interfaces" title="Permalink to this headline">¶</a></h2>
<p>A typical workflow takes data as input and produces data as the result of one or
more operations. One can set the data required by a workflow directly as
illustrated below.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">fsl_tutorial2</span> <span class="kn">import</span> <span class="n">preproc</span>
<span class="n">preproc</span><span class="o">.</span><span class="n">base_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">)</span>
<span class="n">preproc</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">inputspec</span><span class="o">.</span><span class="n">func</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="s">&#39;data/s1/f3.nii&#39;</span><span class="p">)</span>
<span class="n">preproc</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">inputspec</span><span class="o">.</span><span class="n">struct</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="s">&#39;data/s1/struct.nii&#39;</span><span class="p">)</span>
<span class="n">preproc</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
<p>Typical neuroimaging studies require running workflows on multiple subjects or
different parameterizations of algorithms. One simple approach to that would be
to simply iterate over subjects.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">fsl_tutorial2</span> <span class="kn">import</span> <span class="n">preproc</span>
<span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">subjects</span><span class="p">:</span>
  <span class="n">preproc</span><span class="o">.</span><span class="n">base_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">)</span>
  <span class="n">preproc</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">inputspec</span><span class="o">.</span><span class="n">func</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="s">&#39;data/</span><span class="si">%s</span><span class="s">/f3.nii&#39;</span><span class="o">%</span><span class="n">name</span><span class="p">)</span>
  <span class="n">preproc</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">inputspec</span><span class="o">.</span><span class="n">struct</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="s">&#39;data/</span><span class="si">%s</span><span class="s">/struct.nii&#39;</span><span class="o">%</span><span class="n">name</span><span class="p">)</span>
  <span class="n">preproc</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
<p>However, in the context of complex workflows and given that users typically
arrange their imaging and other data in a semantically hierarchical data store,
an alternative mechanism for reading and writing the data generated by a workflow
is often necessary. As the names suggest DataGrabber is used to get at data
stored in a shared file system while <a class="reference internal" href="../interfaces/generated/nipype.interfaces.io.html#nipype-interfaces-io-datasink"><span>DataSink</span></a> is used to store the data
generated by a workflow into a hierarchical structure on disk.</p>
</div>
<div class="section" id="datagrabber">
<h2>DataGrabber<a class="headerlink" href="#datagrabber" title="Permalink to this headline">¶</a></h2>
<p>DataGrabber is an interface for collecting files from hard drive. It is very
flexible and supports almost any file organization of your data you can imagine.</p>
<p>You can use it as a trivial use case of getting a fixed file. By default,
DataGrabber stores its outputs in a field called outfiles.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">nipype.interfaces.io</span> <span class="kn">as</span> <span class="nn">nio</span>
<span class="n">datasource1</span> <span class="o">=</span> <span class="n">nio</span><span class="o">.</span><span class="n">DataGrabber</span><span class="p">()</span>
<span class="n">datasource1</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">base_directory</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
<span class="n">datasource1</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">template</span> <span class="o">=</span> <span class="s">&#39;data/s1/f3.nii&#39;</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">datasource1</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
<p>Or you can get at all uncompressed NIfTI files starting with the letter &#8216;f&#8217; in
all directories starting with the letter &#8216;s&#8217;.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">datasource2</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">base_directory</span> <span class="o">=</span> <span class="s">&#39;/mass&#39;</span>
<span class="n">datasource2</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">template</span> <span class="o">=</span> <span class="s">&#39;data/s*/f*.nii&#39;</span>
</pre></div>
</div>
<p>Two special inputs were used in these previous cases. The input <cite>base_directory</cite>
indicates in which directory to search, while the input <cite>template</cite> indicates the
string template to match. So in the previous case datagrabber is looking for
path matches of the form <cite>/mass/data/s*/f*</cite>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">When used with wildcards (e.g., s* and f* above) DataGrabber does not return
data in sorted order. In order to force it to return data in sorted order, one
needs to set the input <cite>sorted = True</cite>. However, when explicitly specifying an
order as we will see below, <cite>sorted</cite> should be set to <cite>False</cite>.</p>
</div>
<p>More useful cases arise when the template can be filled by other inputs. In the
example below, we define an input field for <cite>datagrabber</cite> called <cite>run</cite>. This is
then used to set the template (see %d in the template).</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">datasource3</span> <span class="o">=</span> <span class="n">nio</span><span class="o">.</span><span class="n">DataGrabber</span><span class="p">(</span><span class="n">infields</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;run&#39;</span><span class="p">])</span>
<span class="n">datasource3</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">base_directory</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
<span class="n">datasource3</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">template</span> <span class="o">=</span> <span class="s">&#39;data/s1/f</span><span class="si">%d</span><span class="s">.nii&#39;</span>
<span class="n">datasource3</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">run</span> <span class="o">=</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">7</span><span class="p">]</span>
</pre></div>
</div>
<p>This will return files <cite>basedir/data/s1/f3.nii</cite> and <cite>basedir/data/s1/f7.nii</cite>. We
can take this a step further and pair subjects with runs.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">datasource4</span> <span class="o">=</span> <span class="n">nio</span><span class="o">.</span><span class="n">DataGrabber</span><span class="p">(</span><span class="n">infields</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;subject_id&#39;</span><span class="p">,</span> <span class="s">&#39;run&#39;</span><span class="p">])</span>
<span class="n">datasource4</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">template</span> <span class="o">=</span> <span class="s">&#39;data/</span><span class="si">%s</span><span class="s">/f</span><span class="si">%d</span><span class="s">.nii&#39;</span>
<span class="n">datasource4</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">run</span> <span class="o">=</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">7</span><span class="p">]</span>
<span class="n">datasource4</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">subject_id</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;s1&#39;</span><span class="p">,</span> <span class="s">&#39;s3&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>This will return files <cite>basedir/data/s1/f3.nii</cite> and <cite>basedir/data/s3/f7.nii</cite>.</p>
<div class="section" id="a-more-realistic-use-case">
<h3>A more realistic use-case<a class="headerlink" href="#a-more-realistic-use-case" title="Permalink to this headline">¶</a></h3>
<p>In a typical study one often wants to grab different files for a given subject
and store them in semantically meaningful outputs. In the following example, we
wish to retrieve all the functional runs and the structural image for the subject &#8216;s1&#8217;.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">datasource</span> <span class="o">=</span> <span class="n">nio</span><span class="o">.</span><span class="n">DataGrabber</span><span class="p">(</span><span class="n">infields</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;subject_id&#39;</span><span class="p">],</span> <span class="n">outfields</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;func&#39;</span><span class="p">,</span> <span class="s">&#39;struct&#39;</span><span class="p">])</span>
<span class="n">datasource</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">base_directory</span> <span class="o">=</span> <span class="s">&#39;data&#39;</span>
<span class="n">datasource</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">template</span> <span class="o">=</span> <span class="s">&#39;*&#39;</span>
<span class="n">datasource</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">field_template</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">func</span><span class="o">=</span><span class="s">&#39;</span><span class="si">%s</span><span class="s">/f</span><span class="si">%d</span><span class="s">.nii&#39;</span><span class="p">,</span>
                                        <span class="n">struct</span><span class="o">=</span><span class="s">&#39;</span><span class="si">%s</span><span class="s">/struct.nii&#39;</span><span class="p">)</span>
<span class="n">datasource</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">template_args</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">func</span><span class="o">=</span><span class="p">[[</span><span class="s">&#39;subject_id&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">10</span><span class="p">]]],</span>
                                       <span class="n">struct</span><span class="o">=</span><span class="p">[[</span><span class="s">&#39;subject_id&#39;</span><span class="p">]])</span>
<span class="n">datasource</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">subject_id</span> <span class="o">=</span> <span class="s">&#39;s1&#39;</span>
</pre></div>
</div>
<p>Two more fields are introduced: <cite>field_template</cite> and <cite>template_args</cite>. These
fields are both dictionaries whose keys correspond to the <cite>outfields</cite>
keyword. The <cite>field_template</cite> reflects the search path for each output field,
while the <cite>template_args</cite> reflect the inputs that satisfy the template. The
inputs can either be one of the named inputs specified by the <cite>infields</cite> keyword
arg or it can be raw strings or integers corresponding to the template. For the
<cite>func</cite> output, the <strong>%s</strong> in the <cite>field_template</cite> is satisfied by <cite>subject_id</cite>
and the <strong>%d</strong> is field in by the list of numbers.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">We have not set <cite>sorted</cite> to <cite>True</cite> as we want the DataGrabber to return the
functional files in the order it was specified rather than in an alphabetic
sorted order.</p>
</div>
</div>
</div>
<div class="section" id="datasink">
<h2>DataSink<a class="headerlink" href="#datasink" title="Permalink to this headline">¶</a></h2>
<p>A workflow working directory is like a <strong>cache</strong>. It contains not only the
outputs of various processing stages, it also contains various extraneous
information such as execution reports, hashfiles determining the input state of
processes. All of this is embedded in a hierarchical structure that reflects the
iterables that have been used in the workflow. This makes navigating the working
directory a not so pleasant experience. And typically the user is interested in
preserving only a small percentage of these outputs. The <a class="reference internal" href="../interfaces/generated/nipype.interfaces.io.html#nipype-interfaces-io-datasink"><span>DataSink</span></a> interface can
be used to extract components from this <cite>cache</cite> and store it at a different
location. For XNAT-based storage, see <a class="reference internal" href="../interfaces/generated/nipype.interfaces.io.html#nipype-interfaces-io-xnatsink"><span>XNATSink</span></a> .</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Unlike other interfaces, a <a class="reference internal" href="../interfaces/generated/nipype.interfaces.io.html#nipype-interfaces-io-datasink"><span>DataSink</span></a>&#8216;s inputs are defined and created by using
the workflow connect statement. Currently disconnecting an input from the
<a class="reference internal" href="../interfaces/generated/nipype.interfaces.io.html#nipype-interfaces-io-datasink"><span>DataSink</span></a> does not remove that connection port.</p>
</div>
<p>Let&#8217;s assume we have the following workflow.</p>
<p class="graphviz">
<img src="../_images/graphviz-d8935623982e8671624a8884784c341ea02e4b00.png" alt="digraph simple_workflow {
&quot;InputNode&quot; -&gt; &quot;Realign&quot; -&gt; &quot;DataSink&quot;;
&quot;InputNode&quot; -&gt; &quot;DataSink&quot;;
}" />
</p>
<p>The following code segment defines the <a class="reference internal" href="../interfaces/generated/nipype.interfaces.io.html#nipype-interfaces-io-datasink"><span>DataSink</span></a> node and sets the <cite>base_directory</cite>
in which all outputs will be stored. The <cite>container</cite> input creates a
subdirectory within the <cite>base_directory</cite>. If you are iterating a workflow over
subjects, it may be useful to save it within a folder with the subject id.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">datasink</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="n">nio</span><span class="o">.</span><span class="n">DataSink</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s">&#39;sinker&#39;</span><span class="p">)</span>
<span class="n">datasink</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">base_directory</span> <span class="o">=</span> <span class="s">&#39;/path/to/output&#39;</span>
<span class="n">workflow</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">inputnode</span><span class="p">,</span> <span class="s">&#39;subject_id&#39;</span><span class="p">,</span> <span class="n">datasink</span><span class="p">,</span> <span class="s">&#39;container&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>If we wanted to save the realigned files and the realignment parameters to the
same place the most intuitive option would be:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">workflow</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">realigner</span><span class="p">,</span> <span class="s">&#39;realigned_files&#39;</span><span class="p">,</span> <span class="n">datasink</span><span class="p">,</span> <span class="s">&#39;motion&#39;</span><span class="p">)</span>
<span class="n">workflow</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">realigner</span><span class="p">,</span> <span class="s">&#39;realignment_parameters&#39;</span><span class="p">,</span> <span class="n">datasink</span><span class="p">,</span> <span class="s">&#39;motion&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>However, this will not work as only one connection is allowed per input port. So
we need to create a second port. We can store the files in a separate folder.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">workflow</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">realigner</span><span class="p">,</span> <span class="s">&#39;realigned_files&#39;</span><span class="p">,</span> <span class="n">datasink</span><span class="p">,</span> <span class="s">&#39;motion&#39;</span><span class="p">)</span>
<span class="n">workflow</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">realigner</span><span class="p">,</span> <span class="s">&#39;realignment_parameters&#39;</span><span class="p">,</span> <span class="n">datasink</span><span class="p">,</span> <span class="s">&#39;motion.par&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>The period (.) indicates that a subfolder called par should be created. But if
we wanted to store it in the same folder as the realigned files, we would use
the <cite>.&#64;</cite> syntax. The &#64; tells the <a class="reference internal" href="../interfaces/generated/nipype.interfaces.io.html#nipype-interfaces-io-datasink"><span>DataSink</span></a> interface to not create the
subfolder. This will allow us to create different named input ports for <a class="reference internal" href="../interfaces/generated/nipype.interfaces.io.html#nipype-interfaces-io-datasink"><span>DataSink</span></a>
and allow the user to store the files in the same folder.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">workflow</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">realigner</span><span class="p">,</span> <span class="s">&#39;realigned_files&#39;</span><span class="p">,</span> <span class="n">datasink</span><span class="p">,</span> <span class="s">&#39;motion&#39;</span><span class="p">)</span>
<span class="n">workflow</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">realigner</span><span class="p">,</span> <span class="s">&#39;realignment_parameters&#39;</span><span class="p">,</span> <span class="n">datasink</span><span class="p">,</span> <span class="s">&#39;motion.@par&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>The syntax for the input port of <a class="reference internal" href="../interfaces/generated/nipype.interfaces.io.html#nipype-interfaces-io-datasink"><span>DataSink</span></a> takes the following form:</p>
<div class="highlight-python"><div class="highlight"><pre>string[[.[@]]string[[.[@]]string] ...]
where parts between paired [] are optional.
</pre></div>
</div>
<div class="section" id="mapnode">
<h3>MapNode<a class="headerlink" href="#mapnode" title="Permalink to this headline">¶</a></h3>
<p>In order to use <a class="reference internal" href="../interfaces/generated/nipype.interfaces.io.html#nipype-interfaces-io-datasink"><span>DataSink</span></a> inside a MapNode, it&#8217;s
inputs have to be defined inside the constructor using the <cite>infields</cite> keyword
arg.</p>
</div>
<div class="section" id="parameterization">
<h3>Parameterization<a class="headerlink" href="#parameterization" title="Permalink to this headline">¶</a></h3>
<p>As discussed in <a class="reference internal" href="mapnode_and_iterables.html"><em>MapNode, iterfield, and iterables explained</em></a>, one can run a workflow iterating
over various inputs using the iterables attribute of nodes. This means that a
given workflow can have multiple outputs depending on how many iterables are
there. Iterables create working directory subfolders such as
<cite>_iterable_name_value</cite>.  The <cite>parameterization</cite> input parameter controls whether
the data stored using <a class="reference internal" href="../interfaces/generated/nipype.interfaces.io.html#nipype-interfaces-io-datasink"><span>DataSink</span></a> is in a folder structure that contains this
iterable information or not. It is generally recommended to set this to <cite>True</cite>
when using multiple nested iterables.</p>
</div>
<div class="section" id="substitutions">
<h3>Substitutions<a class="headerlink" href="#substitutions" title="Permalink to this headline">¶</a></h3>
<p>The <cite>substitutions</cite> and <cite>substitutions_regexp</cite> inputs allow users to modify the
output destination path and name of a file. Substitutions are a list of 2-tuples
and are carried out in the order in which they were entered. Assuming that the
output path of a file is:</p>
<div class="highlight-python"><div class="highlight"><pre>/root/container/_variable_1/file_subject_realigned.nii
</pre></div>
</div>
<p>we can use substitutions to clean up the output path.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">datasink</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">substitutions</span> <span class="o">=</span> <span class="p">[(</span><span class="s">&#39;_variable&#39;</span><span class="p">,</span> <span class="s">&#39;variable&#39;</span><span class="p">),</span>
                                 <span class="p">(</span><span class="s">&#39;file_subject_&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)]</span>
</pre></div>
</div>
<p>This will rewrite the file as:</p>
<div class="highlight-python"><div class="highlight"><pre>/root/container/variable_1/realigned.nii
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">In order to figure out which substitutions are needed it is often useful to
run the workflow on a limited set of iterables and then determine the
substitutions.</p>
</div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>

    <div class="footer" role="contentinfo">
        &copy; Copyright 2009-13, Neuroimaging in Python team.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.3.1.
    </div>
<div class="footer">This page uses <a href="http://analytics.google.com/">
Google Analytics</a> to collect statistics. You can disable it by blocking
the JavaScript coming from www.google-analytics.com.
</div>

  </body>
</html>